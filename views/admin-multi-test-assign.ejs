<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>√áoklu Test Atama - Admin Panel</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .header h1 {
      color: #2d3748;
      font-size: 28px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .btn-back {
      background: linear-gradient(135deg, #4299e1, #3182ce);
      color: white;
      text-decoration: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
    }
    
    .btn-back:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(66, 153, 225, 0.4);
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 30px;
    }
    
    .main-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    
    .form-title {
      font-size: 24px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .form-subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    .alert {
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .alert-success {
      background: linear-gradient(135deg, #48bb78, #38a169);
      color: white;
      border: 2px solid rgba(72, 187, 120, 0.3);
    }
    
    .alert-error {
      background: linear-gradient(135deg, #f56565, #e53e3e);
      color: white;
      border: 2px solid rgba(245, 101, 101, 0.3);
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #374151;
      font-size: 15px;
    }
    
    .required {
      color: #e53e3e;
    }
    
    .form-control {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 16px;
      background: #ffffff;
      transition: all 0.3s ease;
      font-family: inherit;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #4299e1;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
      transform: translateY(-1px);
    }
    
    .help-text {
      margin-top: 8px;
      font-size: 14px;
      color: #718096;
      line-height: 1.4;
    }
    
    .validation-status {
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }
    
    .validation-status.valid {
      background: #c6f6d5;
      color: #22543d;
      border: 1px solid #9ae6b4;
      display: block;
    }
    
    .validation-status.invalid {
      background: #fed7d7;
      color: #742a2a;
      border: 1px solid #fc8181;
      display: block;
    }
    
    .test-selection-area {
      background: #f7fafc;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      margin-top: 10px;
    }
    
    .test-selection-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .test-selection-title {
      font-weight: 600;
      color: #374151;
      font-size: 16px;
    }
    
    .test-counter {
      background: #4299e1;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
    }
    
    .test-item {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 15px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }
    
    .test-item:hover {
      border-color: #4299e1;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(66, 153, 225, 0.2);
    }
    
    .test-item.selected {
      border-color: #48bb78;
      background: linear-gradient(135deg, #f0fff4, #c6f6d5);
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
    }
    
    .test-checkbox {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 20px;
      height: 20px;
      accent-color: #48bb78;
    }
    
    .test-info {
      padding-right: 35px;
    }
    
    .test-name {
      font-weight: 600;
      color: #2d3748;
      margin-bottom: 5px;
      font-size: 15px;
      line-height: 1.3;
    }
    
    .test-code {
      color: #4299e1;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 5px;
    }
    
    .test-details {
      color: #718096;
      font-size: 13px;
    }
    
    .search-filter {
      margin-bottom: 15px;
      position: sticky;
      top: 0;
      background: #f7fafc;
      z-index: 10;
      padding-bottom: 15px;
    }
    
    .search-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #cbd5e0;
      border-radius: 10px;
      font-size: 14px;
      background: white;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #4299e1;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
    }
    
    .btn {
      padding: 16px 32px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #4299e1, #3182ce);
      color: white;
      box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3);
    }
    
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(66, 153, 225, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #a0aec0, #718096);
      color: white;
      box-shadow: 0 4px 15px rgba(160, 174, 192, 0.3);
    }
    
    .btn-secondary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(160, 174, 192, 0.4);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }
    
    .info-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .info-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .info-title {
      font-size: 18px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .info-item {
      padding: 12px 0;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .info-item:last-child {
      border-bottom: none;
    }
    
    .item-label {
      font-weight: 600;
      color: #4a5568;
    }
    
    .item-value {
      color: #2d3748;
      font-weight: 500;
    }
    
    .selected-tests-preview {
      background: #f0fff4;
      border: 2px solid #9ae6b4;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      display: none;
    }
    
    .selected-tests-preview.show {
      display: block;
    }
    
    .preview-title {
      font-weight: 600;
      color: #22543d;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .preview-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .preview-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #c6f6d5;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .preview-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .preview-test-info {
      flex: 1;
    }
    
    .preview-test-name {
      font-weight: 600;
      color: #2d3748;
      font-size: 14px;
    }
    
    .preview-test-code {
      color: #4299e1;
      font-size: 13px;
      font-weight: 500;
    }
    
    .preview-custom-name-input {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #c6f6d5;
      border-radius: 8px;
      font-size: 14px;
      background: #f0fff4;
      transition: all 0.3s ease;
      font-family: inherit;
    }
    
    .preview-custom-name-input:focus {
      outline: none;
      border-color: #48bb78;
      background: white;
      box-shadow: 0 0 0 3px rgba(72, 187, 120, 0.1);
    }
    
    .preview-custom-name-input::placeholder {
      color: #68d391;
      font-style: italic;
    }
    
    .remove-test-btn {
      background: #fed7d7;
      color: #742a2a;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .remove-test-btn:hover {
      background: #fc8181;
      color: white;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #4a5568;
    }
    
    .spinner {
      width: 30px;
      height: 30px;
      border: 3px solid #e2e8f0;
      border-top-color: #4299e1;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .bulk-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .bulk-btn {
      padding: 8px 16px;
      border: 1px solid #cbd5e0;
      background: white;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .bulk-btn:hover {
      background: #f7fafc;
      border-color: #4299e1;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #718096;
    }
    
    .empty-icon {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: 0.5;
    }
    
    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }
      
      .main-card {
        padding: 30px 25px;
      }
      
      .test-grid {
        grid-template-columns: 1fr;
      }
      
      .btn-group {
        flex-direction: column;
      }
    }
    
    @media (max-width: 768px) {
      .test-grid {
        max-height: 300px;
      }
      
      .bulk-actions {
        flex-direction: column;
        gap: 8px;
      }
      
      .bulk-btn {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>üéØ √áoklu Test Atama</h1>
      <a href="/admin/dashboard" class="btn-back">‚Üê Dashboard'a D√∂n</a>
    </div>
  </div>
  
  <div class="container">
    <div class="main-card">
      <div class="form-title">
        üì§ Bir √ñƒürenciye √áoklu Test Atama
      </div>
      <div class="form-subtitle">
        Tek bir √∂ƒürenciye birden fazla test atayabilirsiniz.
      </div>
      
      <% if (basari) { %>
        <div class="alert alert-success">
          ‚úÖ <%= basari %>
        </div>
      <% } %>
      
      <% if (hata) { %>
        <div class="alert alert-error">
          ‚ö†Ô∏è <%= hata %>
        </div>
      <% } %>
      
      <form method="POST" action="/admin/multi-test-assign" id="multiAssignForm">
        <div class="form-group">
          <label for="student_number">
            √ñƒürenci Numarasƒ± <span class="required">*</span>
          </label>
          <input
            type="text"
            id="student_number"
            name="student_number"
            class="form-control"
            placeholder="√ñrn: 1001"
            required
            autocomplete="off"
            oninput="validateStudent()"
          >
          <div class="help-text">
            Testleri atanacak √∂ƒürencinin numarasƒ±nƒ± girin
          </div>
          <div class="validation-status" id="studentValidation"></div>
        </div>
        
        <div class="form-group">
          <label>
            Test Se√ßimi <span class="required">*</span>
          </label>
          <div class="test-selection-area">
            <div class="test-selection-header">
              <div class="test-selection-title">Mevcut Testler</div>
              <div class="test-counter" id="testCounter">0 se√ßili</div>
            </div>
            
            <div class="search-filter">
              <input
                type="text"
                class="search-input"
                placeholder="üîç Test ara (kod veya ad)..."
                id="testSearch"
                oninput="filterTests()"
              >
            </div>
            
            <div class="bulk-actions">
              <button type="button" class="bulk-btn" onclick="selectAllTests()">‚úÖ T√ºm√ºn√º Se√ß</button>
              <button type="button" class="bulk-btn" onclick="deselectAllTests()">‚ùå T√ºm√ºn√º Kaldƒ±r</button>
              <button type="button" class="bulk-btn" onclick="toggleSelection()">üîÑ Se√ßimi Tersine √áevir</button>
            </div>
            
            <div class="test-grid" id="testGrid">
              <% if (testler.length === 0) { %>
                <div class="empty-state">
                  <div class="empty-icon">üìù</div>
                  <div>Hen√ºz test bulunamadƒ±</div>
                </div>
              <% } else { %>
                <% testler.forEach(function(test) { %>
                  <div class="test-item" onclick="toggleTestSelection('<%= test.test_kodu %>')">
                    <input 
                      type="checkbox" 
                      name="selected_tests" 
                      value="<%= test.test_kodu %>"
                      class="test-checkbox"
                      id="test_<%= test.test_kodu %>"
                      onchange="updateTestSelection()"
                    >
                    <div class="test-info">
                      <div class="test-name"><%= test.test_adi %></div>
                      <div class="test-code">üîë <%= test.test_kodu %></div>
                      <div class="test-details"><%= test.soru_sayisi %> soru</div>
                    </div>
                  </div>
                <% }); %>
              <% } %>
            </div>
          </div>
          <div class="help-text">
            Atamak istediƒüiniz testleri se√ßin. √ñzel adlar a≈üaƒüƒ±daki "Se√ßilen Testler" b√∂l√ºm√ºnden verilebilir.
          </div>
        </div>
        
        <div class="selected-tests-preview" id="selectedPreview">
          <div class="preview-title">
            üìã Se√ßilen Testler ve √ñzel Adlar
          </div>
          <div class="preview-list" id="previewList">
            <!-- Se√ßilen testler buraya gelecek -->
          </div>
        </div>
        
        <div class="loading" id="loading">
          <div class="spinner"></div>
          ƒ∞≈ülem devam ediyor...
        </div>
        
        <div class="btn-group">
          <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
            üéØ Testleri Ata
          </button>
          <button type="button" class="btn btn-secondary" onclick="clearForm()">
            üîÑ Formu Temizle
          </button>
        </div>
      </form>
    </div>
    
    <div class="info-panel">
      <div class="info-card">
        <div class="info-title">‚ÑπÔ∏è Bilgilendirme</div>
        <div class="info-item">
          <span class="item-label">Toplam Test</span>
          <span class="item-value"><%= testler.length %> adet</span>
        </div>
        <div class="info-item">
          <span class="item-label">√áoklu Se√ßim</span>
          <span class="item-value">Destekli</span>
        </div>
        <div class="info-item">
          <span class="item-label">√ñzel Adlandƒ±rma</span>
          <span class="item-value">Her test i√ßin</span>
        </div>
        <div class="info-item">
          <span class="item-label">Duplicate Kontrol</span>
          <span class="item-value">Otomatik</span>
        </div>
      </div>
      
      <div class="info-card">
        <div class="info-title">üéØ Kullanƒ±m</div>
        <div class="info-item">
          <span class="item-label">1. Adƒ±m</span>
          <span class="item-value">√ñƒürenci numarasƒ± girin</span>
        </div>
        <div class="info-item">
          <span class="item-label">2. Adƒ±m</span>
          <span class="item-value">Testleri se√ßin</span>
        </div>
        <div class="info-item">
          <span class="item-label">3. Adƒ±m</span>
          <span class="item-value">A≈üaƒüƒ±da testlere √∂zel ad verin</span>
        </div>
        <div class="info-item">
          <span class="item-label">4. Adƒ±m</span>
          <span class="item-value">Atama yapƒ±n</span>
        </div>
      </div>
      
      <div class="info-card">
        <div class="info-title">‚ö†Ô∏è √ñnemli Notlar</div>
        <div class="info-item">
          <span class="item-label">Mevcut Testler</span>
          <span class="item-value">Atlanƒ±r</span>
        </div>
        <div class="info-item">
          <span class="item-label">√ñzel Adlar</span>
          <span class="item-value">√ñƒürenciye g√∂sterilir</span>
        </div>
        <div class="info-item">
          <span class="item-label">ƒ∞≈ülem Loglarƒ±</span>
          <span class="item-value">Otomatik kaydedilir</span>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    let studentValidationTimer;
    let studentValid = false;
    let selectedTests = new Set();
    
    function validateStudent() {
      const input = document.getElementById('student_number');
      const validation = document.getElementById('studentValidation');
      
      clearTimeout(studentValidationTimer);
      
      const studentNumber = input.value.trim();
      
      if (!studentNumber) {
        validation.style.display = 'none';
        studentValid = false;
        updateSubmitButton();
        return;
      }
      
      validation.textContent = 'üîç Kontrol ediliyor...';
      validation.className = 'validation-status';
      validation.style.display = 'block';
      
      studentValidationTimer = setTimeout(() => {
        fetch(`/admin/ogrenci-kontrol?numara=${encodeURIComponent(studentNumber)}`)
          .then(response => response.json())
          .then(data => {
            if (data.bulundu) {
              validation.textContent = `‚úÖ √ñƒürenci bulundu: ${data.ad} ${data.soyad}`;
              validation.className = 'validation-status valid';
              studentValid = true;
            } else {
              validation.textContent = '‚ùå √ñƒürenci bulunamadƒ±';
              validation.className = 'validation-status invalid';
              studentValid = false;
            }
            updateSubmitButton();
          })
          .catch(error => {
            console.error('√ñƒürenci kontrol hatasƒ±:', error);
            validation.textContent = '‚ö†Ô∏è Kontrol edilemedi';
            validation.className = 'validation-status invalid';
            studentValid = false;
            updateSubmitButton();
          });
      }, 500);
    }
    
    function toggleTestSelection(testCode) {
      const checkbox = document.getElementById(`test_${testCode}`);
      checkbox.checked = !checkbox.checked;
      updateTestSelection();
    }
    
    function updateTestSelection() {
      const checkboxes = document.querySelectorAll('input[name="selected_tests"]');
      selectedTests.clear();
      
      checkboxes.forEach(checkbox => {
        const testItem = checkbox.closest('.test-item');
        if (checkbox.checked) {
          selectedTests.add(checkbox.value);
          testItem.classList.add('selected');
        } else {
          testItem.classList.remove('selected');
        }
      });
      
      updateTestCounter();
      updateSelectedPreview();
      updateSubmitButton();
    }
    
    function updateTestCounter() {
      const counter = document.getElementById('testCounter');
      counter.textContent = `${selectedTests.size} se√ßili`;
    }
    
    function updateSelectedPreview() {
      const preview = document.getElementById('selectedPreview');
      const previewList = document.getElementById('previewList');
      
      if (selectedTests.size === 0) {
        preview.classList.remove('show');
        return;
      }
      
      preview.classList.add('show');
      previewList.innerHTML = '';
      
      selectedTests.forEach(testCode => {
        const checkbox = document.getElementById(`test_${testCode}`);
        const testItem = checkbox.closest('.test-item');
        const testName = testItem.querySelector('.test-name').textContent;
        
        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';
        previewItem.innerHTML = `
          <div class="preview-item-header">
            <div class="preview-test-info">
              <div class="preview-test-name">${testName}</div>
              <div class="preview-test-code">${testCode}</div>
            </div>
            <button type="button" class="remove-test-btn" onclick="removeTestFromSelection('${testCode}')">
              ‚ùå Kaldƒ±r
            </button>
          </div>
          <input 
            type="text"
            name="custom_names[${testCode}]"
            class="preview-custom-name-input"
            placeholder="Bu test i√ßin √∂zel ad girebilirsiniz (isteƒüe baƒülƒ±)"
            data-test-code="${testCode}"
          >
        `;
        
        previewList.appendChild(previewItem);
      });
    }
    
    function removeTestFromSelection(testCode) {
      const checkbox = document.getElementById(`test_${testCode}`);
      checkbox.checked = false;
      updateTestSelection();
    }
    
    function filterTests() {
      const searchTerm = document.getElementById('testSearch').value.toLowerCase();
      const testItems = document.querySelectorAll('.test-item');
      
      testItems.forEach(item => {
        const testName = item.querySelector('.test-name').textContent.toLowerCase();
        const testCode = item.querySelector('.test-code').textContent.toLowerCase();
        
        if (testName.includes(searchTerm) || testCode.includes(searchTerm)) {
          item.style.display = 'block';
        } else {
          item.style.display = 'none';
        }
      });
    }
    
    function selectAllTests() {
      const checkboxes = document.querySelectorAll('input[name="selected_tests"]');
      checkboxes.forEach(checkbox => {
        if (checkbox.closest('.test-item').style.display !== 'none') {
          checkbox.checked = true;
        }
      });
      updateTestSelection();
    }
    
    function deselectAllTests() {
      const checkboxes = document.querySelectorAll('input[name="selected_tests"]');
      checkboxes.forEach(checkbox => {
        checkbox.checked = false;
      });
      updateTestSelection();
    }
    
    function toggleSelection() {
      const checkboxes = document.querySelectorAll('input[name="selected_tests"]');
      checkboxes.forEach(checkbox => {
        if (checkbox.closest('.test-item').style.display !== 'none') {
          checkbox.checked = !checkbox.checked;
        }
      });
      updateTestSelection();
    }
    
    function updateSubmitButton() {
      const submitBtn = document.getElementById('submitBtn');
      const hasStudent = studentValid;
      const hasTests = selectedTests.size > 0;
      
      submitBtn.disabled = !(hasStudent && hasTests);
      
      if (!hasStudent) {
        submitBtn.textContent = 'üéØ √ñnce √∂ƒürenci se√ßin';
      } else if (!hasTests) {
        submitBtn.textContent = 'üéØ Test se√ßin';
      } else {
        submitBtn.textContent = `üéØ ${selectedTests.size} Testi Ata`;
      }
    }
    
    function clearForm() {
      document.getElementById('multiAssignForm').reset();
      selectedTests.clear();
      studentValid = false;
      
      document.querySelectorAll('.test-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      document.getElementById('studentValidation').style.display = 'none';
      document.getElementById('selectedPreview').classList.remove('show');
      document.getElementById('testSearch').value = '';
      
      updateTestCounter();
      updateSubmitButton();
      filterTests();
    }
    
    // Form submit olduƒüunda loading g√∂ster
    document.getElementById('multiAssignForm').addEventListener('submit', function(e) {
      if (selectedTests.size === 0) {
        e.preventDefault();
        alert('En az bir test se√ßmelisiniz!');
        return;
      }
      
      // DEBUG: Form submit √∂ncesi √∂zel adlarƒ± kontrol et
      console.log('üîç Form submit ediliyor...');
      const customNameInputs = document.querySelectorAll('input[name^="custom_names"]');
      console.log(`üìù Toplam √∂zel ad inputu: ${customNameInputs.length}`);
      
      customNameInputs.forEach((input, index) => {
        console.log(`  ${index + 1}. Input: name="${input.name}", value="${input.value}"`);
      });
      
      const loading = document.getElementById('loading');
      const submitBtn = document.getElementById('submitBtn');
      
      loading.style.display = 'block';
      submitBtn.disabled = true;
      submitBtn.textContent = 'ƒ∞≈üleniyor...';
    });
    
    // Sayfa y√ºklendiƒüinde
    document.addEventListener('DOMContentLoaded', function() {
      updateSubmitButton();
      updateTestCounter();
    });
  </script>
</body>
</html>